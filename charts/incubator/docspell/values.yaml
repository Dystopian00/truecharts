image:
  repository: tccr.io/truecharts/docspell-server
  tag: v0.38.0@sha256:bcd3f651f83fc482a0bd8bb2606870146376656a438e7b8fe051f3496d405f3d
  pullPolicy: IfNotPresent

joexImage:
  repository: tccr.io/truecharts/docspell-joex
  tag: v0.38.0@sha256:16f2c2e32d8b20f8cdd1b62ae458ded2bbb16ed7bdc2727dc4a7624298ef7021
  pullPolicy: IfNotPresent

# TODO: Check if we create it as separate app. It's a document consumer
dscImage:
  repository: tccr.io/truecharts/docspell-dsc
  tag: v0.38.0@sha256:86c8100df78f47f00291de0c2395917427f6caacbf896691559296c0a805a7a9
  pullPolicy: IfNotPresent

podSecurityContext:
  runAsUser: 0
  runAsGroup: 0

securityContext:
  runAsNonRoot: false
  readOnlyRootFilesystem: false

envFrom:
  - secretRef:
      name: '{{ include "tc.common.names.fullname" . }}-server-secret'
  - configMapRef:
      name: '{{ include "tc.common.names.fullname" . }}-server-config'

rest_server:
  # -- App name, shows on the top right corner
  app_name: Docspell
  base_url: ""
  # -- This defines whether the classification form in the collective settings is displayed or not.
  show_classification_settings: true
  # -- This is a hard limit to restrict the size of a batch that is returned when searching for items.
  max_item_page_size: 200
  # -- The number of characters to return for each item notes when searching.
  max_note_length: 180
  admin_endpoint:
    # -- Disables endpoint if empty
    secret: ""
  auth:
    # -- How long a authentication token is valid
    session_valid: 5 minutes
    remember_me:
      enabled: true
      # -- How long the remember me cookie/token is valid.
      valid: 30 days
  addons:
    # TODO: Check how exactly addons work. There are mentions of docker daemon
    enabled: false
    # -- Whether installing addons requiring network should be allowed or not.
    allow_impure: true
    # -- Define patterns of urls that are allowed to install addons from.
    allowed_urls:
      - "*"
    # -- Define patterns of urls that are denied to install addons from.
    denied_urls: []
  download_all:
    # -- How many files to allow in a zip.
    max_files: 500
    # --- The maximum (uncompressed) size of the zip file contents.
    max_size: 1400M
  logging:
    # -- The format for the log messages. Can be one of:
    # -- Json | Logfmt | Fancy | Plain
    format: Fancy
    # -- The minimum level to log. From lowest to highest:
    # -- Trace | Debug | Info | Warn | Error
    minimum_level: Warn
    levels:
      # -- Override the log level of specific loggers
      docspell: Info
      flywaydb: Info
      binny: Info
      http4s: Info
  server_opts:
    # -- Enable HTTP2
    enable_http2: false
    # -- Maximum allowed connections
    max_connections: 1024
    # -- Timeout for waiting for the first output of the response
    response_timeout: 45s
  integration_endpoint:
    enabled: false
    # -- The priority to use when submitting files through this endpoint.
    # low | high
    priority: low
    # -- The name used for the item "source" property when uploaded through this endpoint.
    source_name: integration
    allowed_ips:
      enabled: false
      ips:
        - "127.0.0.1"
    http_basic_auth:
      enabled: false
      realm: Docspell Integration
      user: docspell-int
      password: docspell-int
    http_header:
      enabled: false
      header_name: Docspell-Integration
      header_value: some-secret
  backend:
    # -- Enable or disable debugging for e-mail related functionality
    mail_debug: false
    database_schema:
      # --  Whether to run main database migrations.
      run_main_migrations: true
      # -- Whether to run the fixup migrations.
      run_fixup_migrations: true
      # -- Use with care. This repairs all migrations in the database by updating their checksums and removing failed migrations.
      repair_schema: false
    signup:
      # -- The mode defines if new users can signup or not.
      # open | invite | closed
      mode: open
      # -- This is the period an invitation token is considered valid.
      invite_time: 3 days
    files:
      # -- Defines the chunk size (in bytes) used to store the files.
      chunk_size: 524288
      # -- The file content types that are considered valid.
      valid_mime_types: []
      # database | minio | filesystem
      default_store: database
      stores:
        database:
          enabled: true
        minio:
          enabled: false
          endpoint: http://localhost:9000
          access_key: access_key
          secret_key: secret_key
          bucket: docspell
        # -- Highly NOT recommended
        filesystem:
          enabled: false
          directory: /documents
  # full_text_search:
  #   enabled:
  #   backend:
  #   solr:
  #     url:
  #     commit_within:
  #     log_verbose:
  #     def_type:
  #     q_op:
  #   postgresql:
  #     use_default_connection:
  #     jdbc:
  #       url:
  #       user:
  #       password:
  #     pg_config:
  #     pg_query_parser:
  #     pg_rank_normalization:
  # openid:

joex:
  # -- Enable or disable debugging for e-mail related functionality. This applies to both sending and receiving mails.
  mail_debug: false
  send_mail:
    # -- This is used as the List-Id e-mail header when mails are sent from docspell to its users
    list_id: ""
  scheduler:
    # -- Number of processing allowed in parallel.
    pool_size: 1
    # -- A counting scheme determines the ratio of how high and low priority jobs are run.
    counting_scheme: 4,1
    # -- How many times a failed job should be retried until it enters failed state.
    retries: 2
    # -- The delay until the next try is performed for a failed job.
    retry_delay: 1 minute
    # -- The queue size of log statements from a job.
    log_buffer_size: 500
    # -- If no job is left in the queue, the scheduler will wait until a notify is requested.
    wakeup_period: 30 minutes
  periodic_scheduler:
    # -- A fallback to start looking for due periodic tasks regularly.
    wakeup_period: 10 minutes
  user_tasks:
    scan_mailbox:
      # -- A limit of how many folders to scan through.
      max_folders: 50
      # -- How many mails (headers only) to retrieve in one chunk.
      mail_chunk_size: 50
      # -- A limit on how many mails to process in one job run.
      max_mails: 500
  logging:
    # -- The format for the log messages. Can be one of:
    # -- Json | Logfmt | Fancy | Plain
    format: Fancy
    # -- The minimum level to log. From lowest to highest:
    # -- Trace | Debug | Info | Warn | Error
    minimum_level: Warn
    levels:
      # -- Override the log level of specific loggers
      docspell: Info
      flywaydb: Info
      binny: Info
      http4s: Info
  database_schema:
    # -- Whether to run main database migrations.
    run_main_migrations: true
    # -- Whether to run the fixup migrations.
    run_fixup_migrations: true
    # -- Use with care. This repairs all migrations in the database by updating their checksums and removing failed migrations.
    repair_schema: false

service:
  main:
    ports:
      main:
        port: 10320
        protocol: HTTP
  joex:
    enabled: true
    type: ClusterIP
    ports:
      joex:
        enabled: true
        port: 10321
        protocol: HTTP

postgresql:
  enabled: true
  existingSecret: dbcreds
  postgresqlUsername: docspell
  postgresqlDatabase: docspell

solr:
  enabled: true
  existingSecret: solrcreds
  solrCores: docspell
  solrUsername: docspell

portal:
  enabled: true
