image:
  repository: jokobsk/pi.alert
  pullPolicy: IfNotPresent
  tag: latest@sha256:b7ef9d403d011d58170573a56cecd5b5bd4b67415369cd2e8a93f364b3fc78b2

securityContext:
  readOnlyRootFilesystem: false
  runAsNonRoot: false

podSecurityContext:
  runAsUser: 0
  runAsGroup: 0

hostNetwork: true

pialert:
  general:
    web_protection: false
    # If true...
    web_password: ""
    print_log: false
    report_dashboard_url: http://localhost
    days_to_keep_events: 90
    scan_cycle_minutes: 5
    # Empty means all
    # internet,new_devices,down_devices,events
    included_sections: []
    scan_subnets:
      - cidr: "192.168.1.0/24"
        interface: eth0
  pushsafer:
    enabled: false
    # If true...
    token: ""
  apprise:
    enabled: false
    # If true...
    host: ""
    url: ""
  ntfy:
    enabled: false
    # If true...
    host: ""
    topic: ""
    user: ""
    password: ""
  webhook:
    enabled: false
    # If true...
    url: ""
    # json,html,text
    payload: json
    method: GET
  email:
    enabled: false
    # If true...
    server: ""
    port: 587
    report_to: ""
    report_from: ""
    skip_login: false
    skip_tls: false
    user: ""
    password: ""
  mqtt:
    enabled: false
    # If true...
    broker: ""
    port: 1883
    user: ""
    password: ""
    qos: 0
    delay_sec: 2
  dyndns:
    enabled: false
    # If true...
    domain: ""
    user: ""
    password: ""
    update_url: ""
  pholus:
    enabled: false
    # If true...
    timeout: 20
    force: false
    days_data: 7
    run: once
    run_timeout: 300
    run_schedule: "0 4 * * *"
  pihole:
    # If enabled you need to map '/etc/pihole/pihole-FTL.db' with additional storage
    pihole_active: false
    # If enabled you need to map '/etc/pihole/dhcp.leases' with additional storage
    dhcp_active: false

env:
  HOST_USER_ID: "{{ .Values.podSecurityContext.runAsUser }}"
  HOST_USER_GID: "{{ .Values.podSecurityContext.fsGroup }}"
  PORT: "{{ .Values.service.main.ports.main.port }}"

service:
  main:
    ports:
      main:
        protocol: HTTP
        port: 10600

persistence:
  config:
    enabled: true
    mountPath: /home/pi/pialert/config
  db:
    enabled: true
    mountPath: /home/pi/pialert/db
  pialert-config:
    enabled: true
    mountPath: /home/pi/pialert/config/pialert.conf
    type: secret
    objectName: '{{ template "tc.common.names.fullname" . }}-secret'
    items:
      - key: pialert.conf
        path: pialert.conf

# installContainers:
#   createdb:
#     image: "{{ .Values.image.repository }}:{{ .Values.image.tag }}"
#     volumeMounts:
#       - name: db
#         mountPath: /home/pi/pialert/db
#     command: ["/bin/sh", "-c"]
#     args:
#       - |-
#         echo "Creating pialert.db file..."
#         if [ -f /home/pi/pialert/db/pialert.db ]; then
#           echo "db file exists!, Skipping..."
#         else
#           echo "db file is missing, getting a new one!"
#           curl -fLvo /home/pi/pialert/db/pialert.db https://raw.githubusercontent.com/jokob-sk/Pi.Alert/main/db/pialert.db || ( echo "Downloading config file, FAILED..." && exit 1 )
#         fi

portal:
  enabled: true
