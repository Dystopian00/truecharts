image:
  repository: tccr.io/truecharts/meshcentral
  pullPolicy: IfNotPresent
  tag: 1.0.85@sha256:86ea102f40926709ce7bab442fc961822860aa8dd70b13b3b2e8af6e4edef2c9

command:
  - node
  - /home/node/meshcentral/node_modules/meshcentral/meshcentral.js
  - --configfile
  - /home/node/meshcentral/meshcentral-config/config.json
  - --cert
  - "{{ .Values.meshcentral.settings.cert }}"

# command:
#   - /bin/bash
#   - -c
#   - ls /opt
# - cat /home/node/meshcentral/meshcentral-config/config.json

securityContext:
  readOnlyRootFilesystem: false
  runAsNonRoot: false

podSecurityContext:
  runAsUser: 0
  runAsGroup: 0

# - Values with the character _ in-front of them are ignored. Add or remove _ to disable or enable options
# - Any service that uses port other than 443, need to be manually configured.
# TODO: Loop through all the keys and rename KEY to _KEY if it's not set/empty
meshcentral:
  settings:
    mongoDbBulkOperations: true
    # - The actual main port as seen externally on the Internet, this setting is often used when a reverse-proxy is used.
    # - Remove _ if ingress is enabled
    aliasPort: 443
    # - When set, relayPort value is ignored. Set this to a DNS name the points to this server. When the server is accessed using the DNS name, the main web server port is used as a web relay port.
    _relayDNS:
      - ""
    # - Automatically downloads all agent error logs into meshcentral-data/agenterrorlogs.txt.
    agentLogDump: false
    # - Automatically activates and transfers any agent crash dump files to the server in meshcentral-data/coredumps.
    agentCoreDump: false
    # - List of non-administrator users that have access to mesh agent crash dumps.
    _agentCoreDumpUsers:
      - ""
    # - When code signing an agent using authenticode, lock the agent to only allow connection to this server. (This is in testing, the default value will change to true in the future).
    _agentSignLock: false
    # - The time stamping server to use when code signing Windows executables. When set to false, the executables are not time stamped.
    _agentTimeStampServer: http://timestamp.comodoca.com/authenticode
    # - The HTTP proxy to use when contacting the time stamping server, if false, no proxy is used. By default, the npmproxy value is used.
    _agentTimeStampProxy:
    # - When set to true, MeshCentral will only grab the required TCP listening ports or fail. It will not try to use the next available port of it's busy.
    _exactPorts: false
    # - Set this to the primary DNS name of this MeshCentral server.
    cert: mc.domain.com
    # - Force MeshCentral to use the HTTPS and MPS certificates even if the name does not match the expected DNS value.
    keepCerts: false
    # - When enabled, only MeshCentral WAN features are enabled and agents will connect to the server using a well known DNS name.
    WANonly: true
    # - When enabled, only MeshCentral LAN features are enabled and agents will find the server using multicast LAN packets.
    _LANonly: false
    # - When enabled the server is in maintenance mode, only administrators can login. Use the maintenance command in server console to change.
    _maintenanceMode: false
    allowLoginToken: false
    # - Controls the Strict-Transport-Security header, default is 1 year. Set to false to remove, true to force enable, or string to set a custom value. If set to null, MeshCentral will enable if a trusted certificate is set.
    _StrictTransportSecurity: null
    # - When enabled, the MeshCentral web site can be embedded within another website's iframe.
    allowFraming: false
    # - strict | lax | none
    _cookieIpCheck: lax
    # - When enabled, allows use of WebRTC to allow direct network traffic between the agent and browser.
    webRTC: false
    # - By default, a nice looking 404 error page is displayed when needed. Set this to false to disable it.
    nice404: true
    # - When specified, sends data to the browser at x seconds interval and expects a response from the browser.
    _browserPing: 300
    # - When specified, sends data to the browser at x seconds interval.
    _browserPong: 300
    # - Loads all agent binaries in RAM for faster agent updates.
    _agentsInRam: false
    # - When specified, sends data to the agent at x seconds interval and expects a response from the agent.
    _agentPing: 300
    # - When specified, sends data to the agent at x seconds interval.
    _agentPong: 300
    # - When enabled, MeshCentral will automatically monitor and manage Intel AMT devices.
    _amtManager: true
    # - If an agent attempts to connect to a unknown device group, automatically create a new device group and grant access to the specified user. Example: admin
    _orphanAgentUser: null
    # - How much time in seconds with no traffic from an agent before dropping the agent connection.
    _agentIdleTimeout: 150
    # - Adds a random length string to generated web pages to mitigate a BREACH attack.
    _webPageLengthRandomization: true
    # - Enables GZIP compression for web requests.
    _compression: true
    # - Enables server-side, websocket per-message deflate compression.
    wsCompression: true
    # - Enables agent-side, websocket per-message deflate compression. wscompression must also be true for this to work.
    _agentWsCompression: true
    # - Set to 1 to present the server from updating any agent.
    _noAgentUpdate: 0
    # - When set to 2, all agents that need to be updated will use the meshcore.js update system. With the default value of 1, the native update system is used.
    _agentUpdateSystem: 1
    # - Set to false to not allow temporary agents to be updated.
    _temporaryAgentUpdate: true
    # - Set to false to disable Intel AMT scanning on the local network, this is already disabled in WAN mode.
    _amtScanner: true
    # - Set to false to disable agent multicast scanning on the local network, this is already disabled in WAN mode.
    _meshScanner: true
    # - When false, users will only be able to set remote desktop image quality to 60%, this can reduce server bandwidth usage.
    _allowHighQualityDesktop: true
    # - When set with a valid email address, enables the MeshCentral web push notification feature. Allows administrators to send browser notifications to users even if they are not looking at the MeshCentral web site.
    _webPush:
      # - Server administrator email given to the FireFox and Chrome push notification services.
      email: null
    # - Duration of a session cookie in minutes. Changing this affects how often the session needs to be automatically refreshed.
    sessionTime: 60
    # - strict | lax | none
    sessionSameSite: lax
    # - Amount of time to keep various events in the database, in seconds.
    dbExpire:
      # - Amount of time in seconds that events are kept in the database.
      events: 1728000
      # - Amount of time in seconds that device power events are kept in the database.
      powerevents: 864000
      # - Amount of time in seconds that server statistics are kept in the database.
      statsevents: 2592000
    # - Execute this when the server startup is completed. The first parameter will be the server version.
    _RunOnServerStarted: null
    # - Execute this when the server has been updated. The first parameter will be the server version.
    _RunOnServerUpdated: null
    # - Execute this when the server has to restart due to an error. The first parameter will be the server version.
    _RunOnServerError: null
    # - When true, this server uses MeshCentral.com a push notification relay for Android notifications. Push notifications work even if the Android app is not open.
    _publicPushNotifications: false
    # - When true, enabled a server modules that efficiently splits a remote desktop stream to multiple browsers. Also allows slow browsers to not slow down the session for fast ones, this comes at the cost of extra server memory and processing for all remote desktop sessions.
    _desktopMultiplex: false
    # - If set, a user from a banned IP address will be redirected to this URL.
    _ipBlockedUserRedirect: null
    # - When set, only users from allowed IP address ranges can connect to the server. Example: 192.168.2.100,192.168.1.0/24
    _userAllowedIP: null
    # - When set, users from these denied IP address ranges will not be able to connect to the server. Example: 192.168.2.100,192.168.1.0/24
    _userBlockedIP: null
    # - When set, only agents from allowed IP address ranges can connect to the server. Example: 192.168.2.100,192.168.1.0/24
    _agentAllowedIP: null
    # - When set, agents from these denied IP address ranges will not be able to connect to the server. Example: 192.168.2.100,192.168.1.0/24
    _agentBlockedIP: null
    # - File path and name of the authentication log to be created. This log can be parsed by Fail2ban.
    _authLog: null
    # Users in this list are allowed to send and receive inter-user messages. This can be used to implement bots or other software where MeshCentral is used as data transport. See interuser websocket command in the code.
    _InterUserMessaging:
      - ""
    # - Users in this list are allowed to see and manage all device groups within their domain.
    _manageAllDeviceGroups:
      - ""
    # - Users in this list are allowed to manage all users in all domains.
    _manageCrossDomain:
      - ""
    # - When this server is in LAN mode, you may discover this server using a multicast discovery tool. When discovery happens, the name and info fields are sent back to the discovery tool.
    _localDiscovery:
      name: null
      info: null
      # - When set, encrypts all LAN discovery traffic to agents and tools using this key. This is only useful in LAN/Hybrid mode when agents and tools user multicast to find the server.
      key: null
    # - When true, indicates that a TLS offloader is in front of the MeshCentral server. More typically, set this to the IP address of the reverse proxy or TLS offloader so that IP forwarding headers will be trusted. For example: 127.0.0.1,192.168.1.100
    _tlsOffload: false
    # - Trust forwarded headers from these IPs or domains.  Providing the magic string "CloudFlare" will cause the server to download the IP address list of trusted CloudFlare proxies directly from CloudFlare on each server start. For example: 127.0.0.1,proxy.example.com,CloudFlare
    _trustedProxy: null
    # - The Management Presence Server (MPS), this is the server that received Intel AMT Client Initiated Remote Access (CIRA) connections.
    _mpsPort: 4433
    _mpsAliasPort: null
    _mpsAliasHost: null
    # - When set to true, indicate that TLS is being performed by a device in front of MeshCentral.
    _mpsTlsOffload: false
    # - When set to true, the MPS server will only accept TLS 1.2 and 1.3 connections. Older Intel AMT devices will not be able to connect.
    _mpsHighSecurity: false
    # - Send syslog events over the network (RFC3164) to a target hostname:port. For example: localhost:514
    _syslogtcp: null
    # - The STUN servers used for WebRTC, if not specified the Google and Mozilla servers and used when the server is not in LAN mode.
    _webrtcConfig:
      iceServers:
        - urls: ""
    # - Enabled the MeshCentral built-in Crowdsec bouncer. This section is passed directly to the bouncer, all of the settings are documented at https://www.npmjs.com/package/@crowdsec/express-bouncer
    _crowdsec:
      # - The URL of your LAPI instance. Ex: http://localhost:8080
      url: null
      # - The bouncer key (generated via cscli).
      apiKey: null
      # - Action to perform if the CrowdSec agent can't be contacted. bypass | captcha | ban
      failbackRemediation: ban
    _redirects:
      meshcommander: https://www.meshcommander.com/
    # - This section described a policy for how many times an IP address is allowed to attempt to login incorrectly. By default it's 10 times in 10 minutes, but this can be changed here.
    _maxInvalidLogin:
      # - Ranges of IP addresses that are not subject to invalid login limitations. For example: 192.168.1.0/24,172.16.0.1
      exclude: null
      # - Time in minutes over which the a maximum number of invalid login attempts is allowed from an IP address.
      time: 10
      # - Maximum number of invalid login attempts from an IP address in the time period.
      count: 10
      # - Additional time in minute that login attempts will be denied once the invalid login limit is reached.
      coolofftime: null
    # - This section described a policy for how many times an IP address is allowed to attempt to perform two-factor authentication (2FA) incorrectly. By default it's 10 times in 10 minutes, but this can be changed here.
    _maxInvalid2fa:
      # - Ranges of IP addresses that are not subject to invalid 2FA limitations. For example: 192.168.1.0/24,172.16.0.1
      exclude: null
      # - Time in minutes over which the a maximum number of invalid 2FA attempts is allowed from an IP address.
      time: 10
      # - Maximum number of invalid 2FA attempts from an IP address in the time period.
      count: 10
      # - Additional time in minute that 2FA attempts will be denied once the invalid login limit is reached.
      coolofftime: null
    # - When present, this section will enable the Intel AMT provisioning server on the local network. This is used for Intel AMT bare-metal ACM activation.
    _amtProvisioningServer:
      # - Port number that provisioning server will listen to.
      port: 9971
      # - The agent-less device group to add Intel AMT devices to once they are activated. Must be of format: mesh/domain/id
      deviceGroup: null
      # - The MEBX password to set during activation. This password must be at least 8 characters long and have 1 lower, 1 upper, 1 alpha-numeric and 1 non-alpha numeric character.
      newMebxPassword: null
      # - The trusted FQDN or provisioning server value the remote device will have. This can be set in MEBx or using the DHCP server option 15 on the local network.
      trustedFqdn: null
      # - The IP address of this server. This address will be used when creating the USB setup.bin file to indicate what IP address to send the hello data to.
      ip: null
    _plugins:
      enabled: true
  # - Any settings in this section is used as default setting for all domains
  _domaindefaults:
    title: Default Title
  domains:
    "":
      # - HTTPS URL when to get the TLS certificate that MeshAgent's will see when connecting to this server. This setting is used when a reverse proxy like Traefik is used in front of MeshCentral.
      certUrl: https://mc.domain.com
      # - The title of this web site. All web pages will have this title.
      title: TrueCharts MeshCentral
      # - Secondary title text that is placed on the upper right on the title on many web pages.
      title2: TrueCharts MeshCentral
      # - When enabled, the server will send reduced sized web pages.
      minify: true
      # - 0 = User selects day/night mode, 1 = Always night mode, 2 = Always day mode
      nightMode: 0
      # - Valid numbers are 1 and 2, changes the style of the login page and some secondary pages.
      siteStyle: 2
      # - When set to false, this setting will disable the mobile site.
      mobileSite: true
      # - Set to true to enable IP KVM device support in this domain.
      ipkvm: false
      # - When set to true, allow new user accounts to be created from the login page.
      newAccounts: false
      # - When set this password will be required in order to create a new account from the login screen.
      _newAccountsPass: ""
      # - When set to true, users will get a CAPTCHA when creating a new account from the login screen.
      _newAccountsCaptcha: false
      _newAccountsUserGroups:
        - ""
      # - The maximum number of devices a user can see on the devices page at the same time. By default all devices will show, but this may need to be limited on servers with large number of devices.
      _maxDeviceView: 1000
      _userQuota: 1048576
      _meshQuota: 248576
      # - Requires that users add the value ?key=xxx in the URL in order to see the web site.
      _loginKey:
        - ""
      # - Requires that agents add the value ?key=xxx in the URL in order to connect. This is not automatic and needs to be manually added in the meshagent.msh file.
      _agentKey:
        - ""
      # - Web site .png logo file that is 450x66 in size placed in meshcentral-data that is used on the top of many pages.
      _titlePicture: ""
      # - Web site .png logo file placed in meshcentral-data that used on the login page when sitestyle is 2.
      _loginPicture: ""
      # - Redirects HTTP root requests to this URL. When in use, direct users to /login to see the normal login page.
      _rootRedirect: ""
      # - Redirects HTTP root requests to this URL only where user is not already logged in. When in use, direct users to /login to see the normal login page.
      _unknownUserRootRedirect: ""
      # - Text that will be shown on the login screen.
      welcomeText: Welcome to TrueCharts MeshCentral
      # - Name of the PNG or JPEG file that will be shown on the login screen. Put this file in the meshcentral-data folder and place the file name here.
      _welcomePicture: null
      # - When enabled, the welcomePicture will show as a fullscreen background on the login screen.
      _welcomePictureFullScreen: false
      # - Text that will be displayed on the top of the messenger window when no username or device name is displayed.
      _meshMessengerTitle: TrueCharts MeshCentral
      # - Name of a .png image file that is placed in meshcentral-data that is displayed on the top of the messenger web page. When null, the default image is displayed.
      _meshMessengerPicture: null
      # - Sum of: 1 = Hide header, 2 = Hide tab, 4 = Hide footer, 8 = Hide title, 16 = Hide left bar, 32 = Hide back buttons
      _hide: 0
      # - This is a HTML string displayed at the bottom of the web page when a user is logged in.
      _footer: null
      # - This is a HTML string displayed at the bottom of the web page when a user is not logged in.
      _loginfooter: null
      # - Allow users to save SSH, RDP, VNC device credentials on the server that can be used by any other user.
      _allowSavingDeviceCredentials: true
      # - This value is normally auto-detected, when set to true, MeshCentral assumes that the TLS certificate comes from a trusted CA and will insure download tools perform certificate checking.
      _trustedCert: null
      # When set to false, the desktop/terminal sharing link feature is not available.
      _guestDeviceSharing:
        # - When set, limits the maximum length of a guest session, in minutes.
        maxSessionTime: null
      # - Number of days a device can be inactive before it's removed. 0 disables this feature. Device group setting will override this value.
      _autoRemoveInactiveDevices: 0
      # - When set to true, the devices search box will match on both the server name and client name of a device.
      _deviceSearchBarServerAndClientName: false
      # - When set to true, MeshCentral Assistant can create it's own guest sharing links.
      _agentSelfGuestSharing:
        # - When set, limits the self-created guest sharing link to this number of minutes.
        expire: null
service:
  main:
    ports:
      main:
        protocol: HTTPS
        port: 10205
  # mps:
  #   enabled: true
  #   ports:
  #     mps:
  #       enabled: true
  #       port: 4433
  #       targetPort: 4433
  # amtprovisioner:
  #   enabled: true
  #   ports:
  #     amtprovisioner:
  #       enabled: true
  #       port: 9971
  #       targetPort: 9971

mongodb:
  enabled: true
  mongodbUsername: meshcentral
  mongodbDatabase: meshcentral
  existingSecret: mongodbcreds

persistence:
  data:
    enabled: true
    mountPath: /home/node/meshcentral/meshcentral-data
  files:
    enabled: true
    mountPath: /home/node/meshcentral/meshcentral-files
  configfile:
    enabled: true
    type: secret
    readOnly: true
    # defaultMode: "0600"
    objectName: '{{ include "tc.common.names.fullname" . }}-secret'
    mountPath: /home/node/meshcentral/meshcentral-config
    items:
      - key: config.json
        path: config.json

portal:
  enabled: true
