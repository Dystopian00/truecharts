image:
  repository: tccr.io/truecharts/crowdsec
  tag: v1.4.1@sha256:cd7b6cd8e4774cdafb3862961f607de6fc513ea87d5b7a039a0a06bc3a5a97ed
  pullPolicy: IfNotPresent

dashboardImage:
  repository: tccr.io/truecharts/metabase
  tag: v0.44.4@sha256:07cbf35571ee2e23aedd222cac80c1876a979e0244eb5320f618ce045db9aa59
  pullPolicy: IfNotPresent

securityContext:
  readOnlyRootFilesystem: false
  runAsNonRoot: false

podSecurityContext:
  runAsUser: 0
  runAsGroup: 0

envFrom:
  - secretRef:
      name: '{{ include "tc.common.names.fullname" . }}-credentials-secret'
  - configMapRef:
      name: '{{ include "tc.common.names.fullname" . }}-agent-config'

crowdsec:
  credentials:
    username: username
    password: password
  agent:
    # docker | containerd
    container_runtime: docker
    local_apI_url: http://localhost:8080
    acquisition:
      pods:
        - name: truenas
          namespace: ""
          program: nginx
        - name: native
          namespace: test-native
          program: traefik
      raw_log_paths:
        - path: /path1
          program: nginx
        - path: /path2
          type: test-type
          program: test-app
  lapi:
    dashboard:
      assetURL: https://crowdsec-statics-assets.s3-eu-west-1.amazonaws.com/metabase_sqlite.zip

metrics:
  # -- Enable and configure a Prometheus serviceMonitor for the chart under this key.
  # @default -- See values.yaml
  enabled: false
  serviceMonitor:
    interval: 1m
    scrapeTimeout: 30s
    labels: {}
  # -- Enable and configure Prometheus Rules for the chart under this key.
  # @default -- See values.yaml
  prometheusRule:
    enabled: false
    labels: {}
    # -- Configure additionial rules for the chart under this key.
    # @default -- See prometheusrules.yaml
    rules:
      []
      # - alert: UnifiPollerAbsent
      #   annotations:
      #     description: Unifi Poller has disappeared from Prometheus service discovery.
      #     summary: Unifi Poller is down.
      #   expr: |
      #     absent(up{job=~".*unifi-poller.*"} == 1)
      #   for: 5m
      #   labels:
      #     severity: critical

persistence:
  crowdsec-config:
    enabled: true
    mountPath: /etc/crowdsec
  crowdsec-data:
    enabled: true
    mountPath: /var/lib/crowdsec/data
  metabase-data:
    enabled: true
    mountPath: /metabase-data
  varlog:
    enabled: true
    type: hostPath
    readOnly: true
    mountPath: /var/log
    hostPath: /var/log
  acquis-config:
    enabled: true
    readOnly: true
    type: custom
    mountPath: /etc/crowdsec/acquis.yaml
    subPath: acquis.yaml
    volumeSpec:
      configMap:
        name: '{{ include "tc.common.names.fullname" . }}-acquis-config'

service:
  main:
    ports:
      main:
        port: 11001
        protocol: HTTP
        targetPort: 3000
  lapi:
    enabled: true
    type: ClusterIP
    ports:
      lapi:
        enabled: true
        port: 11000
        protocol: HTTP
        targetPort: 8080

portal:
  enabled: true
