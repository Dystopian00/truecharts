image:
  repository: tccr.io/truecharts/zabbix-server
  tag: 6.2.3@sha256:8047806dbb02b779c1fa4dc47f96bc02f35836800ee21a260ccf2e88928c6e97
  pullPolicy: IfNotPresent

webImage:
  repository: tccr.io/truecharts/zabbix-web
  tag: 6.2.3@sha256:b58cdcfe7ab5d8d80b46f6766aea7f44f5ce2ac8c80ecf0c5450e206fd692e1d
  pullPolicy: IfNotPresent

agent2Image:
  repository: tccr.io/truecharts/zabbix-agent2
  tag: 6.2.3@sha256:5abdc777ae777b9941c45d4fe9c9cb73f5491550318430dffd1ab9c03af7ed60
  pullPolicy: IfNotPresent

snmptrapsImage:
  repository: tccr.io/truecharts/zabbix-snmptraps
  tag: 6.2.3@sha256:46142f4717a8e8f27da16a82690a62f6bbb18dc5db423610faec53cedf7db8fe
  pullPolicy: IfNotPresent

tty: true

securityContext:
  readOnlyRootFilesystem: false
  runAsNonRoot: false

podSecurityContext:
  runAsUser: 0
  runAsGroup: 0

zabbix:
  # -- https://www.zabbix.com/documentation/current/en/manual/appendix/config/zabbix_server
  server:
    listen_backlog: ""
    debug_level: 3
    timeout: 4
    # TODO: add webservice
    web_service_url: http://localhost:10053/report
    service_manager_sync_freq: 60
    start_report_writers: 0
    start_pollers: 5
    ipmi_pollers: 0
    start_preprocessors: 3
    start_pollers_unreachable: 1
    start_trappers: 5
    start_pingers: 1
    start_discoverers: 1
    start_history_pollers: 5
    start_http_pollers: 1
    start_obdc_pollers: 1
    start_timers: 1
    start_escalators: 1
    start_alerters: 3
    start_java_pollers: 5
    start_vmware_collectors: 0
    vmware_frequency: 60
    vmware_perf_frequency: 60
    vmware_cache_size: 8M
    vmware_timeout: 10
    housekeeping_freq: 1
    max_housekeeper_delete: 5000
    problem_housekeeper_freq: 60
    sender_freq: 30
    cache_size: 8M
    cache_update_freq: 60
    start_db_syncers: 4
    history_cache_size: 16M
    history_index_cache_size: 4M
    history_storage_date_index: false
    trend_cache_size: 4M
    trend_function_cache_size: 4M
    value_cache_size: 4M
    trapper_timeout: 300
    unreachable_period: 45
    unavailable_delay: 60
    unreachable_delay: 15
    log_slow_queries: 3000
    start_proxy_pollers: 1
    proxy_config_freq: 3600
    proxy_data_freq: 1
    start_lld_processors: 2
    export_file_size: 1G
    export_type: []
    stats_allowed_ips: []
    # TODO: add snmp traps
    enable_snmp_traps: false
    # TODO: add java gateway
    java_gateway_enabled: false
  frontend:
    server_name: My Zabbix Server
    enable_access_logs: true
    max_execution_time: 300
    memory_limit: 128M
    post_max_size: 16M
    upload_max_file_size: 2M
    max_input_time: 300
    session_name: zbx_sessionid
    access_ip_range: []
    deny_gui_access: false
    warning_message: Zabbix Server is under maintenance
    # Advanced
    sso_settings: ""
    php_fpm_pm: dynamic
    php_fpm_pm_max_children: 50
    php_fpm_pm_start_servers: 5
    php_fpm_pm_min_spare_servers: 5
    php_fpm_pm_max_spare_servers: 35
    php_fpm_pm_max_requests: 0
  agent:
    hostname: Zabbix server
    hostname_item: ""
    metadata: ""
    metadata_item: ""
    passive_allow: true
    active_allow: true
    timeout: 3
    enable_persistent_buffer: false
    persistent_buffer_period: 1h
    log_remote_commands: false
    start_agents: 3
    refresh_active_checks: 120
    buffer_send: 5
    buffer_size: 100
    max_line_per_second: 20
    unsafe_user_parameters: false
    tls_connect: unencrypted
    tls_accept: unencrypted
    psk_identity: ""
    psk_file: ""
    allow_key: ""
    deny_key: ""

envFrom:
  - secretRef:
      name: '{{ include "tc.common.names.fullname" . }}-common-secret'
  - configMapRef:
      name: '{{ include "tc.common.names.fullname" . }}-common-config'
  - configMapRef:
      name: '{{ include "tc.common.names.fullname" . }}-server-config'

service:
  main:
    ports:
      main:
        port: 10211
        targetPort: 8080
  server:
    enabled: true
    ports:
      server:
        enabled: true
        port: 10051
  agent:
    type: ClusterIP
    enabled: true
    ports:
      agent:
        enabled: true
        port: 10050
  snmptraps:
    enabled: true
    ports:
      snmptraps:
        protocol: UDP
        enabled: true
        port: 162
        targetPort: 1162

probes:
  liveness:
    custom: true
    spec:
      exec:
        command:
          - /bin/bash
          - -ec
          - "until zabbix_server -R ha_status; do sleep 2; done"
  readiness:
    custom: true
    spec:
      exec:
        command:
          - /bin/bash
          - -ec
          - "until zabbix_server -R ha_status; do sleep 2; done"
  startup:
    custom: true
    spec:
      exec:
        command:
          - /bin/bash
          - -ec
          - "until zabbix_server -R ha_status; do sleep 2; done"

additionalContainers:
  #   agent:
  #     name: agent
  #     image: "{{ .Values.agentImage.repository }}:{{ .Values.agentImage.tag }}"
  #     env:
  #       - name: ZBX_HOSTNAME
  #         value: "{{ .Release.Name }}-{{ randAlphaNum 5 }}"
  #       - name: ZBX_SERVER_HOST
  #         value: "localhost"
  #       - name: ZBX_SERVER_PORT
  #         value: "{{ .Values.service.server.ports.server.targetPort }}"
  snmptraps:
    name: snmptraps
    image: "{{ .Values.snmptrapsImage.repository }}:{{ .Values.snmptrapsImage.tag }}"
    volumeMounts:
      - name: snmptraps
        mountPath: "/var/lib/zabbix/snmptraps"

persistence:
  # Agent2 Volumes
  agent_conf:
    enabled: true
    noMount: true
    mountPath: /etc/zabbix/zabbix_agentd.d
  agent_enc:
    enabled: true
    noMount: true
    mountPath: /var/lib/zabbix/enc
  agent_buffer:
    enabled: true
    noMount: true
    mountPath: /var/lib/zabbix/buffer
  # Web
  web_certs:
    enabled: true
    noMount: true
    mountPath: /etc/zabbix/web/certs
  # Shared
  snmptraps:
    enabled: true
    mountPath: "/var/lib/zabbix/snmptraps"
  # Server
  # alertscripts:
  #   enabled: true
  #   mountPath: "/usr/lib/zabbix/alertscripts"
  # externalscripts:
  #   enabled: true
  #   mountPath: "/usr/lib/zabbix/externalscripts"
  # modules:
  #   enabled: true
  #   mountPath: "/var/lib/zabbix/modules"
  # enc:
  #   enabled: true
  #   mountPath: "/var/lib/zabbix/enc"
  # ssh_keys:
  #   enabled: true
  #   mountPath: "/var/lib/zabbix/ssh_keys"
  # sslcerts:
  #   enabled: true
  #   mountPath: "/var/lib/zabbix/ssl/certs"
  # sslkeys:
  #   enabled: true
  #   mountPath: "/var/lib/zabbix/ssl/keys"
  # sslca:
  #   enabled: true
  #   mountPath: "/var/lib/zabbix/ssl/ssl_ca"
  # mibs:
  #   enabled: true
  #   mountPath: "/var/lib/zabbix/mibs"
  # export:
  #   enabled: true
  #   mountPath: "/var/lib/zabbix/export"
  # SNMP-Traps
  # snmp-mibs:
  #     enabled: true
  #     mountPath: "/var/lib/zabbix/mibs"

postgresql:
  enabled: true
  existingSecret: "dbcreds"
  postgresqlUsername: zabbix
  postgresqlDatabase: zabbix

portal:
  enabled: true
