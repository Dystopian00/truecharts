image:
  repository: zabbix/zabbix-server-pgsql
  tag: ubuntu-6.0.3@sha256:cef1152d9928a0d83223e42b264705b2d8079e49279a6c90f9f7758b3d0e3483
  pullPolicy: IfNotPresent

frontImage:
  repository: zabbix/zabbix-web-nginx-pgsql
  tag: ubuntu-6.0.3@sha256:49b13531b28f31afba3c32a6ec162885790615244a7d4be82123582f6610da18
  pullPolicy: IfNotPresent

securityContext:
  readOnlyRootFilesystem: false
  runAsNonRoot: false

podSecurityContext:
  runAsUser: 0
  runAsGroup: 0

env:
  DB_SERVER_PORT: 5432
  POSTGRES_USER: "{{ .Values.postgresql.postgresqlUsername }}"
  POSTGRES_DB: "{{ .Values.postgresql.postgresqlDatabase }}"
  ZBX_LISTENPORT: 10051
  ZBX_WEBSERVICEURL: "http://localhost:8080/report"
  # Needs additional container for snmptraps + shared volume
  # ZBX_ENABLE_SNMP_TRAPS: true
  # User Defined
  ZBX_DEBUGLEVEL: 5

frontendConfig:
  ZBX_SERVER_NAME: "My Zabbix Instance"
  ZBX_MAXEXECUTIONTIME: 300
  ZBX_MEMORYLIMIT: "128M"
  ZBX_POSTMAXSIZE: "16M"
  ZBX_UPLOADMAXFILESIZE: "2M"
  ZBX_MAXINPUTTIME: 300
  ZBX_DENY_GUI_ACCESS: false
  ZBX_GUI_WARNING_MSG: "My Zabbix instance is currently in maintenance"

envValueFrom:
  POSTGRES_PASSWORD:
    secretKeyRef:
      name: dbcreds
      key: postgresql-password
  DB_SERVER_HOST:
    secretKeyRef:
      name: dbcreds
      key: plainhost

service:
  main:
    ports:
      main:
        port: 10211
        targetPort: 10051

# additionalContainers:
#   front:
#     name: front
#     image: "{{ .Values.frontImage.repository }}:{{ .Values.frontImage.tag }}"
#     ports:
#       - containerPort: 8080
#         name: main
#     env:
#       - name: ZBX_SERVER_HOST
#         value: "localhost"
#       - name: ZBX_SERVER_PORT
#         value: "{{ .Values.env.ZBX_LISTENPORT }}"
#       - name: POSTGRES_DB
#         value: "{{ .Values.postgresql.postgresqlDatabase }}"
#       - name: POSTGRES_USER
#         value: "{{ .Values.postgresql.postgresqlUsername }}"
#       - name: DB_SERVER_PORT
#         value: "{{ .Values.env.DB_SERVER_PORT }}"
#       - name: PHP_TZ
#         value: "{{ .Values.TZ }}"
#       # History storage HTTP[S] URL. This parameter is used for Elasticsearch setup.
#       # - name: ZBX_HISTORYSTORAGEURL
#       #   value: "ELASTICSEARCHURL"
#       # Array of value types to be sent to the history storage. An example: ['uint', 'dbl']. This parameter is used for Elasticsearch setup.
#       # - name: ZBX_HISTORYSTORAGETYPES
#       #   value: "['uint', 'dbl']"
#       - name: DB_SERVER_HOST
#         valueFrom:
#           secretKeyRef:
#             name: dbcreds
#             key: plainhost
#       - name: POSTGRES_PASSWORD
#         valueFrom:
#           secretKeyRef:
#             name: dbcreds
#             key: postgresql-password
#       # User Defined
#       - name: ZBX_SERVER_NAME
#         value: "{{ .Values.frontendConfig.ZBX_SERVER_NAME }}"
#       - name: ZBX_MAXEXECUTIONTIME
#         value: "{{ .Values.frontendConfig.ZBX_MAXEXECUTIONTIME }}"
#       - name: ZBX_MEMORYLIMIT
#         value: "{{ .Values.frontendConfig.ZBX_MEMORYLIMIT }}"
#       - name: ZBX_POSTMAXSIZE
#         value: "{{ .Values.frontendConfig.ZBX_POSTMAXSIZE }}"
#       - name: ZBX_UPLOADMAXFILESIZE
#         value: "{{ .Values.frontendConfig.ZBX_UPLOADMAXFILESIZE }}"
#       - name: ZBX_MAXINPUTTIME
#         value: "{{ .Values.frontendConfig.ZBX_MAXINPUTTIME }}"
#       - name: ZBX_DENY_GUI_ACCESS
#         value: "{{ .Values.frontendConfig.ZBX_DENY_GUI_ACCESS }}"
#       - name: ZBX_GUI_WARNING_MSG
#         value: "{{ .Values.frontendConfig.ZBX_GUI_WARNING_MSG }}"

# persistence:
  # alertscripts:
  #   enabled: true
  #   mountPath: "/usr/lib/zabbix/alertscripts"
  # externalscripts:
  #   enabled: true
  #   mountPath: "/usr/lib/zabbix/externalscripts"
  # modules:
  #   enabled: true
  #   mountPath: "/var/lib/zabbix/modules"
  # enc:
  #   enabled: true
  #   mountPath: "/var/lib/zabbix/enc"
  # ssh_keys:
  #   enabled: true
  #   mountPath: "/var/lib/zabbix/ssh_keys"
  # sslcerts:
  #   enabled: true
  #   mountPath: "/var/lib/zabbix/ssl/certs"
  # sslkeys:
  #   enabled: true
  #   mountPath: "/var/lib/zabbix/ssl/keys"
  # sslca:
  #   enabled: true
  #   mountPath: "/var/lib/zabbix/ssl/ssl_ca"
  # snmptraps:
  #   enabled: true
  #   mountPath: "/var/lib/zabbix/snmptraps"
  # mibs:
  #   enabled: true
  #   mountPath: "/var/lib/zabbix/mibs"
  # export:
  #   enabled: true
  #   mountPath: "/var/lib/zabbix/export"

postgresql:
  enabled: true
  existingSecret: "dbcreds"
  postgresqlUsername: zabbix
  postgresqlDatabase: zabbix
