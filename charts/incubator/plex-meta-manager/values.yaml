image:
  repository: tccr.io/truecharts/plex-meta-manager
  pullPolicy: IfNotPresent
  tag: v1.17.1@sha256:138b60cdde3cd08ae25a78c44d8a03da715538d76dc137318dc3fdde19ba4bcd

securityContext:
  readOnlyRootFilesystem: false
  runAsNonRoot: false

podSecurityContext:
  runAsUser: 0
  runAsGroup: 0

env:
  PMM_CONFIG: "/config/config.yaml"
  PMM_RUN: true
  PMM_NO_COUNTDOWN: true

service:
  main:
    ports:
      main:
        port: 10281
        targetPort: 10281
        protocol: HTTP

probes:
  liveness:
    enabled: false
  readiness:
    enabled: false
  startup:
    enabled: false

persistence:
  config:
    enabled: true
    mountPath: "/config"

initContainers:
  1-create-init-config-file:
    image: "{{ .Values.image.repository }}:{{ .Values.image.tag }}"
    volumeMounts:
      - name: config
        mountPath: "/config"
    command: ["/bin/sh", "-c"]
    args:
      - |-
        echo "Creating config.yaml file..."
        echo "current tag {{ .Values.image.tag }}"
        if [ -e /config/config.yaml ]; then
          echo "Init file exists!"
          exit 0
        else
          curl -fLvo /config/config.yaml https://raw.githubusercontent.com/meisnate12/Plex-Meta-Manager/master/config/config.yml.template
          echo "Init file created successfully!"
          exit 0
        fi
