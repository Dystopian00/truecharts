image:
  repository: tccr.io/truecharts/kimai
  tag: v1.19@sha256:d5347792e4f8ff0e747e3bc2a98a07f1665d4ca96a92742d60ef4ed16d84a3aa
  pullPolicy: IfNotPresent

nginxImage:
  repository: tccr.io/truecharts/nginx
  tag: v1.21.6@sha256:1de1a51a7a17d8036b4e926e6906d3784f45cf03ee1e33095efce1db631beb8e

securityContext:
  runAsNonRoot: false
  readOnlyRootFilesystem: false

podSecurityContext:
  runAsUser: 33
  runAsGroup: 33
  fsGroup: 33

secret:
  ADMINMAIL: "admin@mysecretdomain.com"
  ADMINPASS: "MvvTfjagiaqDprGNVA"

env:
  DB_TYPE: "mysql"
  DB_PORT: "3306"
  DB_USER: "{{ .Values.mariadb.mariadbDatabase }}"
  DB_BASE: "{{ .Values.mariadb.mariadbUsername }}"
  # User Defined
  TRUSTED_HOSTS: "localhost"

envValueFrom:
  DB_PASS:
    secretKeyRef:
      name: mariadbcreds
      key: mariadb-password
  DB_HOST:
    secretKeyRef:
      name: mariadbcreds
      key: plainhost

service:
  main:
    ports:
      main:
        port: 10198
        targetPort: 80

probes:
  liveness:
    enabled: true
    custom: true
    spec:
      exec:
        command:
        - bash
        - -c
        - curl --fail "http://localhost:80/en/login"

  readiness:
    enabled: true
    custom: true
    spec:
      exec:
        command:
        - bash
        - -c
        - curl --fail "http://localhost:80/en/login"

  startup:
    enabled: true
    custom: true
    spec:
      exec:
        command:
        - bash
        - -c
        - curl --fail "http://localhost:80/en/login"

persistence:
  public:
    enabled: true
    type: emptyDir
    mountPath: "/opt/kimai/public"

mariadb:
  enabled: true
  mariadbUsername: kimai
  mariadbDatabase: kimai
  existingSecret: "mariadbcreds"

additionalContainers:
  nginx:
    name: nginx
    image: "{{ .Values.nginxImage.repository }}:{{ .Values.nginxImage.tag }}"
    ports:
      - containerPort: 80
        name: main
    volumeMounts:
    - name: kimai-config
      mountPath: "/etc/nginx/conf.d/default.conf"
      subPath: nginx-config
      readOnly: true
    - name: public
      mountPath: "/opt/kimai/public"
