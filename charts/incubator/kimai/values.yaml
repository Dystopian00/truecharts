image:
  repository: tccr.io/truecharts/kimai
  tag: v2.0.14@sha256:de4c3bd18d4b7a9d324df9923dcb2d358e1a542307ae36c1fa0d8f3cba22880b
  pullPolicy: IfNotPresent

securityContext:
  container:
    readOnlyRootFilesystem: false
    runAsUser: 33
    runAsGroup: 33

service:
  main:
    ports:
      main:
        port: 10198
        protocol: http
        targetPort: 8001

kimai:
  credentials:
    ADMINMAIL: admin@change.me
    ADMINPASS: ChangeME
  trusted_hosts: localhost

workload:
  main:
    podSpec:
      containers:
        main:
          enabled: true
          primary: true
          probes:
            liveness:
              enabled: true
              type: http
              path: "/en/login"
            readiness:
              enabled: true
              type: http
              path: "/en/login"
            startup:
              enabled: true
              type: http
              path: "/en/login"
          env:
            DB_TYPE: "mysql"
            DB_PORT: "3306"
            DB_USER: "{{ .Values.mariadb.mariadbDatabase }}"
            DB_BASE: "{{ .Values.mariadb.mariadbUsername }}"
            APP_ENV: "prod"
            TRUSTED_HOSTS: "{{ .Values.env.trust_hosts }},localhost"
            # User Defined
            trust_hosts: "127.0.0.1"
            DB_PASS:
              secretKeyRef:
                expandObjectName: false
                name: '{{ printf "%s-%s" .Release.Name "mariadbcreds" }}'
                key: mariadb-password
            DB_HOST:
              secretKeyRef:
                expandObjectName: false
                name: '{{ printf "%s-%s" .Release.Name "mariadbcreds" }}'
                key: plainhost
            APP_SECRET:
              secretKeyRef:
                expandObjectName: false
                name: '{{ printf "%s-%s" .Release.Name "kimai-secrets" }}'
                key: APP_SECRET
          envFrom:
            - configMapRef:
                name: kimai-config

persistence:
  data:
    enabled: true
    mountPath: /opt/kimai/var/data
  plugins:
    enabled: true
    mountPath: /opt/kimai/var/plugins

mariadb:
  enabled: true
  mariadbUsername: kimai
  mariadbDatabase: kimai

portal:
  open:
    enabled: true
