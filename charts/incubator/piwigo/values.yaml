image:
  repository: tccr.io/truecharts/piwigo
  pullPolicy: IfNotPresent
  tag: v13.7.0@sha256:9f8bd8ae06a7dfcdb209af444f49119680ce74e58a53df4ac5ed56d9878292f4

securityContext:
  container:
    runAsNonRoot: false
    readOnlyRootFilesystem: false
    runAsUser: 0
    runAsGroup: 0

service:
  main:
    ports:
      main:
        targetPort: 80
        port: 10027

piwigo:
  language: en_US
  admin_user: admin
  admin_pass: admin123
  admin_email: admin@email.com

workload:
  main:
    podSpec:
      containers:
        main:
          lifecycle:
            postStart:
              type: exec
              command:
                - /bin/sh
                - -c
                - |-
                  export language={{ .Values.piwigo.language }};
                  export dbhost={{ .Values.mariadb.creds.plainhost | trimAll "\"" }};
                  export dbhost={{ .Values.mariadb.creds.plainhost | trimAll "\"" }}:3306;
                  export dbuser={{ .Values.mariadb.mariadbUsername }};
                  export dbpasswd={{ .Values.mariadb.creds.mariadbPassword | trimAll "\"" }};
                  export dbname={{ .Values.mariadb.mariadbDatabase }};
                  export admin_name={{ .Values.piwigo.admin_user }};
                  export admin_pass={{ .Values.piwigo.admin_pass }};
                  export admin_email={{ .Values.piwigo.admin_email }};
                - curl
                - -X
                - POST
                - -d
                - "language=$language&dbhost=$dbhost&dbuser=$&dbpasswd=$dbpasswd&dbname=$dbname&prefix=piwigo_&admin_name=$admin_name&admin_pass1=$admin_pass&admin_pass2=$admin_pass&admin_mail=$admin_mail&install=Start+installation"
                - http://0.0.0.0/install.php

persistence:
  config:
    enabled: true
    mountPath: /config
    size: 256Gi
  gallery:
    enabled: true
    mountPath: /gallery
    size: 256Gi
  varrun:
    enabled: true

mariadb:
  enabled: true
  mariadbUsername: piwigo
  mariadbDatabase: piwigo

portal:
  open:
    enabled: true
