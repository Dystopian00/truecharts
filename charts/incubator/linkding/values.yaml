image:
  repository: tccr.io/truecharts/linkding
  tag: v1.8.8@sha256:c5a15b48ef46e409d6d0fe0552280611bcbb148e5311f4ed0e9e12d2360e6578
  pullPolicy: IfNotPresent

securityContext:
  readOnlyRootFilesystem: false
  runAsNonRoot: false

podSecurityContext:
  runAsUser: 0
  runAsGroup: 0

secret:
  DJANGO_SUPERUSER_USERNAME: "superuser"
  DJANGO_SUPERUSER_EMAIL: "super@example.com"
  DJANGO_SUPERUSER_PASSWORD: "somesecret"

env:
  LD_SERVER_PORT: "{{ .Values.service.main.ports.main.port }}"
  # User Defined
  LD_REQUEST_TIMEOUT: 60
  LD_DISABLE_BACKGROUND_TASKS: false
  LD_DISABLE_URL_VALIDATION: false

service:
  main:
    ports:
      main:
        port: 10210

persistence:
  data:
    enabled: true
    mountPath: "/etc/linkding/data"

installContainers:
  1-init-app:
    image: "{{ .Values.image.repository }}:{{ .Values.image.tag }}"
    volumeMounts:
      - name: data
        mountPath: "/etc/linkding/data"
  2-create-superuser:
    image: "{{ .Values.image.repository }}:{{ .Values.image.tag }}"
    volumeMounts:
      - name: data
        mountPath: "/etc/linkding/data"
    env:
      - name: DJANGO_SUPERUSER_PASSWORD
        value: "{{ .Values.env.DJANGO_SUPERUSER_PASSWORD }}"
      - name: DJANGO_SUPERUSER_USERNAME
        value: "{{ .Values.env.DJANGO_SUPERUSER_USERNAME }}"
      - name: DJANGO_SUPERUSER_EMAIL
        value: "{{ .Values.env.DJANGO_SUPERUSER_EMAIL }}"
    command: ["/bin/sh", "-c"]
    args:
      - >
        echo "Creating superuser...";
        python manage.py createsuperuser --username=${DJANGO_SUPERUSER_USERNAME} --email=${DJANGO_SUPERUSER_EMAIL} --noinput;
        echo "Superuser ${DJANGO_SUPERUSER_USERNAME} created!"
