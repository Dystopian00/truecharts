image:
  repository: gitea/gitea
  tag: 1.15.3-rootless
  pullPolicy: IfNotPresent

postgresqlImage:
  repository: bitnami/postgresql
  pullPolicy: IfNotPresent
  tag: 13.4.0@sha256:e7526fc32deec708740784d907bcea2ef6c78bc5ab5265026eff96e70082a54a

service:
  main:
    ports:
      main:
        port: 3000
  ssh:
    ports:
      ssh:
        port: 2222
        targetPort: 2222

envFrom:
  - configMapRef:
      name: gitea-env

initContainers:
  0-init-postgresdb:
    image: "{{ .Values.postgresqlImage.repository}}:{{ .Values.postgresqlImage.tag }}"
    command:
      - "sh"
      - "-c"
      - "until pg_isready -U gitea -h ${pghost} ; do sleep 2 ; done"
    imagePullPolicy: IfNotPresent
    env:
      - name: pghost
        valueFrom:
          secretKeyRef:
            name: dbcreds
            key: plainhost
  1-init-directories:
    image: "{{ .Values.image.repository }}:{{ .Values.image.tag }}"
    command: ["/usr/sbin/init_directory_structure.sh"]
    securityContext:
      runAsUser: 0
      runAsNonRoot: false
    envFrom:
      - configMapRef:
          name: gitea-env
    volumeMounts:
      - name: init
        mountPath: /usr/sbin
      - name: temp
        mountPath: /tmp
      - name: config
        mountPath: /etc/gitea/conf
      - name: data
        mountPath: /data
  2-configure-gitea:
    image: "{{ .Values.image.repository }}:{{ .Values.image.tag }}"
    command: ["/usr/sbin/configure_gitea.sh"]
    envFrom:
      - configMapRef:
          name: gitea-env
    volumeMounts:
      - name: init
        mountPath: /usr/sbin
      - name: temp
        mountPath: /tmp
      - name: data
        mountPath: /data

persistence:
  data:
    enabled: true
    mountPath: "/data"
    type: pvc
    accessMode: ReadWriteOnce
    size: "100Gi"
  temp:
    enabled: true
    mountPath: "/tmp"
    type: emptyDir
  varlib:
    enabled: true
    mountPath: "/var/lib/gitea"
    type: emptyDir

# Configure commit/action signing prerequisites
signing:
  enabled: true
  gpgHome: /data/git/.gnupg

admin:
  username: giteaadmin
  password: r8sA8CPHD9!bt6d
  email: "gitea@local.domain"

metrics:
  enabled: false
  serviceMonitor:
    enabled: false
    #  additionalLabels:
    #    prometheus-release: prom1

ldap:
  enabled: false
  # name:
  # securityProtocol:
  # host:
  # port:
  # userSearchBase:
  # userFilter:
  # adminFilter:
  # emailAttribute:
  # bindDn:
  # bindPassword:
  # usernameAttribute:
  # sshPublicKeyAttribute:

oauth:
  enabled: false
  # name:
  # provider:
  # key:
  # secret:
  # autoDiscoverUrl:
  # useCustomUrls:
  # customAuthUrl:
  # customTokenUrl:
  # customProfileUrl:
  # customEmailUrl:

config:
  APP_NAME: "Gitea: Git with a cup of tea"
  RUN_MODE: dev

customConfig: []
  # - name: test
  #   keys:
  #     - name: testkey
  #       value: testvalue

# Enabled postgres
postgresql:
  enabled: true
  postgresqlUsername: gitea
  postgresqlDatabase: gitea
  existingSecret: dbcreds

# --  memcached dependency settings
memcached:
  enabled: true
