{{- include "tc.v1.common.loader.init" . }}

{{- if .Values.autodiscovery.enabled -}}
{{/* Allow user to override the autodiscovery URL */}}
{{- if .Values.autodiscovery.autodiscoveryUrl -}}
{{- $_ := set .Values.workload.main.podSpec.containers.main.env "JELLYFIN_PublishedServerUrl" .Values.autodiscovery.autodiscoveryUrl -}}
{{- end -}}
{{/* Add proxy workload */}}
{{- $_ := set .Values.workload "broadcastproxy" (include "broadcastProxy.workload" . | fromYaml) -}}
{{- end -}}

{{- include "tc.v1.common.loader.apply" . -}}
