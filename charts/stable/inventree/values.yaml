image:
  repository: tccr.io/truecharts/inventree
  tag: 0.8.1@sha256:6b89f61c3d3eb824fe81689c67f13052d6e733b910e74eece3fb353a54232136
  pullPolicy: IfNotPresent

nginxImage:
  repository: tccr.io/truecharts/nginx
  tag: v1.23.1@sha256:1620254cd011e2b81361f1f4682fd6cceadf13b07f8e37f322b60407d6d5a766

securityContext:
  readOnlyRootFilesystem: false

podSecurityContext:
  runAsUser: 100
  runAsGroup: 0

secretEnv:
  INVENTREE_ADMIN_EMAIL: "test@example.com"
  INVENTREE_ADMIN_USER: "testuser"
  INVENTREE_ADMIN_PASSWORD: "secret"

envFrom:
  - secretRef:
      name: '{{ include "tc.common.names.fullname" . }}-inventree-secret'
  - configMapRef:
      name: '{{ include "tc.common.names.fullname" . }}-inventree-config'

env:
  # User Defined
  INVENTREE_DEBUG: false
  INVENTREE_LOG_LEVEL: "INFO"
  INVENTREE_PLUGINS_ENABLED: false
  INVENTREE_LOGIN_CONFIRM_DAYS: 3
  INVENTREE_LOGIN_ATTEMPTS: 5
  # INVENTREE_EMAIL_BACKEND: "django.core.mail.backends.smtp.EmailBackend"
  # INVENTREE_EMAIL_HOST: ""
  # INVENTREE_EMAIL_PORT: 587
  # INVENTREE_EMAIL_USERNAME: ""
  # INVENTREE_EMAIL_PASSWORD: ""
  # INVENTREE_EMAIL_TLS: "False"
  # INVENTREE_EMAIL_SSL: "False"
  # INVENTREE_EMAIL_SENDER: ""

service:
  main:
    ports:
      main:
        port: 10231
        targetPort: 10231

persistence:
  data:
    enabled: true
    mountPath: "/home/inventree/data"
  inventree-nginx:
    enabled: "true"
    mountPath: "/etc/nginx/nginx.conf"
    subPath: "nginx-config"
    type: "custom"
    volumeSpec:
      configMap:
        name: '{{ include "tc.common.names.fullname" . }}-inventree-config'

initContainers:
  init-migrate:
    name: init-migrate
    image: "{{ .Values.image.repository }}:{{ .Values.image.tag }}"
    securityContext:
      runAsUser: 0
      runAsGroup: 0
      runAsNonRoot: true
      readOnlyRootFilesystem: false
    volumeMounts:
      - name: data
        mountPath: "/home/inventree/data"
    envFrom:
      - secretRef:
          name: '{{ include "tc.common.names.fullname" . }}-inventree-secret'
      - configMapRef:
          name: '{{ include "tc.common.names.fullname" . }}-inventree-config'
    command: ["sh", "-c"]
    args:
      - |-
        cd /home/inventree;
        invoke update;
additionalContainers:
  nginx:
    name: nginx
    image: "{{ .Values.nginxImage.repository }}:{{ .Values.nginxImage.tag }}"
    ports:
      - containerPort: 10231
        name: main
    securityContext:
      runAsUser: 0
      runAsGroup: 100
      readOnlyRootFilesystem: false
      runAsNonRoot: false
    volumeMounts:
      - name: inventree-nginx
        mountPath: "/etc/nginx/conf.d/default.conf"
        subPath: nginx-config
        readOnly: true
      - name: data
        mountPath: "/var/www"
  worker:
    name: worker
    image: "{{ .Values.image.repository }}:{{ .Values.image.tag }}"
    command: ["invoke", "worker"]
    volumeMounts:
      - name: data
        mountPath: "/home/inventree/data"
    envFrom:
      - secretRef:
          name: '{{ include "tc.common.names.fullname" . }}-inventree-secret'
      - configMapRef:
          name: '{{ include "tc.common.names.fullname" . }}-inventree-config'

postgresql:
  enabled: true
  existingSecret: "dbcreds"
  postgresqlUsername: inventree
  postgresqlDatabase: inventree

redis:
  enabled: true
  existingSecret: "rediscreds"

portal:
  enabled: true
