image:
  repository: ipfs/go-ipfs
  pullPolicy: IfNotPresent
  tag: v0.12.1

securityContext:
  runAsNonRoot: false
  readOnlyRootFilesystem: false

podSecurityContext:
  runAsUser: 0
  runAsGroup: 0

env:
  NODE_IP: "localhost"

service:
  main:
    ports:
      main:
        port: 10125
        targetPort: 5001
  peer-tcp:
    enabled: true
    ports:
      peer-tcp:
        enabled: true
        targetPort: 4001
        port: 4001
  peer-udp:
    enabled: true
    ports:
      peer-udp:
        protocol: UDP
        enabled: true
        targetPort: 4001
        port: 4001
  gateway:
    enabled: true
    type: ClusterIP
    ports:
      gateway:
        enabled: true
        targetPort: 8080
        port: 10147

probes:
  liveness:
    path: "/webui"
  readiness:
    path: "/webui"
  startup:
    path: "/webui"

persistence:
  data:
    enabled: true
    mountPath: "/data/ipfs"
  staging:
    enabled: true
    mountPath: "/export"
  ipfs:
    enabled: true
    mountPath: "/ipfs"
  ipns:
    enabled: true
    mountPath: "/ipns"

installContainers:
  1-set-api-httpheaders-cors:
    image: "{{ .Values.image.repository }}:{{ .Values.image.tag }}"
    env:
      - name: NODE_IP
        value: "{{ .Values.env.NODE_IP }}"
    volumeMounts:
      - name: data
        mountPath: "/data/ipfs"
      - name: staging
        mountPath: "/export"
      - name: ipfs
        mountPath: "/ipfs"
      - name: ipns
        mountPath: "/ipns"
    command: ["sh", "-c"]
    args:
      - >
        ipfs config --json API.HTTPHeaders.Access-Control-Allow-Methods '["PUT", "POST"]';
        ipfs config --json API.HTTPHeaders.Access-Control-Allow-Origin '["http://$NODE_IP:5001","http://localhost:3000", "http://127.0.0.1:5001"]';
