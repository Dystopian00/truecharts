{{/* Make sure all variables are set properly */}}
{{- include "tc.v1.common.loader.init" . }}


{{/* Render configmap for k8s-gateway */}}
{{- $configmap := include "k8s-gateway.configmap" . | fromYaml -}}
{{- if $configmap -}}
  {{- $_ := set .Values.configmap "corefile" $configmap -}}
{{- end -}}

{{/* Append the general configMap volume to the volumes */}}
{{- define "k8s-gateway.configvolume" -}}
enabled: true
mountPath: "/etc/coredns"
readOnly: true
type: configmap
objectName: corefile
items:
- key: Corefile
  path: Corefile
{{- end -}}

{{- $_ := set .Values.persistence "config-volume" (include "k8s-gateway.configvolume" . | fromYaml) -}}
{{/* Render the templates */}}
{{ include "tc.v1.common.loader.apply" . }}
