image:
  repository: tccr.io/truecharts/shiori
  pullPolicy: IfNotPresent
  tag: 1.5.4@sha256:d0d145787855f00b81752433cb3cfa047c833926b55a14f845cbe8dbc42b8800

envFrom:
  - secretRef:
      name: '{{ include "tc.common.names.fullname" . }}-secret'

service:
  main:
    ports:
      main:
        port: 10098
        targetPort: 8080

installContainers:
  initdb:
    image: "{{ .Values.image.repository }}:{{ .Values.image.tag }}"
    volumeMounts:
      - name: data
        mountPath: "/data"
    env:
      - name: SHIORI_DIR
        value: "/data"
      - name: SHIORI_DBMS
        value: "postgresql"
      - name: SHIORI_PG_PORT
        value: "5432"
      - name: SHIORI_PG_USER
        value: "{{ .Values.postgresql.postgresqlUsername }}"
      - name: SHIORI_PG_NAME
        value: "{{ .Values.postgresql.postgresqlDatabase }}"
      - name: SHIORI_PG_PASS
        valueFrom:
          secretKeyRef:
            name: dbcreds
            key: postgresql-password
      - name: SHIORI_PG_HOST
        valueFrom:
          secretKeyRef:
            name: dbcreds
            key: plainhost
    command: ["shiori", "migrate"]

persistence:
  data:
    enabled: true
    mountPath: /data
  varrun:
    enabled: true

postgresql:
  enabled: true
  existingSecret: dbcreds
  postgresqlUsername: shiori
  postgresqlDatabase: shiori

portal:
  enabled: true
