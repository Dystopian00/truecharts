image:
  repository: tccr.io/truecharts/vikunja-api
  tag: 0.20.1@sha256:839d6f23b3aa413e10bd252539a04866ad9b7fff3f1a6e2dac894c2674687709
  pullPolicy: IfNotPresent

frontendImage:
  repository: tccr.io/truecharts/vikunja-frontend
  tag: 0.20.2@sha256:556a26579911eb172ce23c903f7484040753e009b51144270eb208445d51edb0
  pullPolicy: IfNotPresent

nginxImage:
  repository: tccr.io/truecharts/nginx
  tag: 1.23.3@sha256:218715557a16838206fc2c924fb2ce39b76f81e46e5c62379f2c6e7a8d1e221d

securityContext:
  readOnlyRootFilesystem: false
  runAsNonRoot: false

podSecurityContext:
  runAsUser: 0
  runAsGroup: 0

configmap:
  nginx-config:
    enabled: true
    data:
      nginx-config: |
        {{ (include "vikunja.nginx" . | fromYaml).nginx }}

vikunja:
  service:
    # API Port, internal
    interface: ":3456"
    jwtttl: 259200
    jwtttllong: 2592000

env:
  VIKUNJA_REDIS_ENABLED: 1
  VIKUNJA_CACHE_ENABLED: 1
  VIKUNJA_CACHE_TYPE: "redis"
  VIKUNJA_DATABASE_TYPE: "postgres"
  VIKUNJA_DATABASE_USER: "{{ .Values.postgresql.postgresqlUsername }}"
  VIKUNJA_DATABASE_DATABASE: "{{ .Values.postgresql.postgresDatabase }}"
  VIKUNJA_SERVICE_TIMEZONE: "{{ .Values.TZ }}"
  # User Defined
  VIKUNJA_SERVICE_FRONTENDURL: "http://localhost:8080"
  VIKUNJA_SERVICE_MAXITEMSPERPAGE: 50
  VIKUNJA_FILES_MAXSIZE: "20MB"
  VIKUNJA_SERVICE_ENABLECALDAV: true
  VIKUNJA_SERVICE_ENABLELINKSHARING: true
  VIKUNJA_SERVICE_ENABLEREGISTRATION: true
  VIKUNJA_SERVICE_ENABLETASKATTACHMENTS: true
  VIKUNJA_SERVICE_ENABLETASKCOMMENTS: true
  VIKUNJA_SERVICE_ENABLETOTP: true
  VIKUNJA_SERVICE_ENABLEEMAILREMINDERS: true
  VIKUNJA_SERVICE_ENABLEUSERDELETION: true
  VIKUNJA_BACKGROUNDS_ENABLED: true
  VIKUNJA_RATELIMIT_ENABLED: false
  VIKUNJA_RATELIMIT_PERIOD: 60
  VIKUNJA_RATELIMIT_LIMIT: 100
  # VIKUNJA_MAILER_HOST: ""
  # VIKUNJA_MAILER_PORT: 587
  # VIKUNJA_MAILER_USERNAME: ""
  # VIKUNJA_MAILER_PASSWORD: ""
  # VIKUNJA_MAILER_FROMEMAIL: ""
  # VIKUNJA_MAILER_SKIPTLSVERIFY: false
  # VIKUNJA_MAILER_FORCESSL: false
  # VIKUNJA_MAILER_QUEUELENGTH: 100
  # VIKUNJA_MAILER_QUEUETIMEOUT: 30
  VIKUNJA_DATABASE_HOST:
    secretKeyRef:
      name: dbcreds
      key: plainhost
  VIKUNJA_DATABASE_PASSWORD:
    secretKeyRef:
      name: dbcreds
      key: postgresql-password
  VIKUNJA_REDIS_HOST:
    secretKeyRef:
      name: rediscreds
      key: plainporthost
  VIKUNJA_REDIS_PASSWORD:
    secretKeyRef:
      name: rediscreds
      key: redis-password
  VIKUNJA_SERVICE_JWT_SECRET:
    secretKeyRef:
      name: vikunja-secrets
      key: VIKUNJA_SERVICE_JWT_SECRET

service:
  main:
    ports:
      main:
        port: 10220

additionalContainers:
  frontend:
    name: frontend
    image: "{{ .Values.frontendImage.repository }}:{{ .Values.frontendImage.tag }}"
  proxy:
    name: proxy
    image: "{{ .Values.nginxImage.repository }}:{{ .Values.nginxImage.tag }}"
    ports:
      - containerPort: 8080
        name: main
    volumeMounts:
      - name: vikunja-nginx
        mountPath: "/etc/nginx/conf.d/default.conf"
        subPath: nginx-config
        readOnly: true

persistence:
  files:
    enabled: true
    mountPath: /app/vikunja/files
  vikunja-nginx:
    enabled: true
    noMount: true
    mountPath: /etc/nginx/conf.d/default.conf
    subPath: nginx-config
    type: configMap
    objectName: '{{ template "tc.common.names.fullname" . }}-nginx-config'
  vikunja-config:
    enabled: true
    mountPath: /etc/vikunja
    subPath: config.yml
    type: secret
    objectName: '{{ template "tc.common.names.fullname" . }}-secret'

postgresql:
  enabled: true
  existingSecret: "dbcreds"
  postgresqlUsername: vikunja
  postgresqlDatabase: vikunja

redis:
  enabled: true
  existingSecret: "rediscreds"

portal:
  enabled: true
